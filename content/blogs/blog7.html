---
categories:
- ""
- ""
date: "2020-09-14T22:42:51-05:00"
description: Relationship between HIV rate and life expectancy by region
draft: false
image: pic09.jpg
keywords: ""
slug: blog7
title: Does the HIV Rate Affect Life Expectancy?
subtitle: Various analyses
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>
<link href="/rmarkdown-libs/lightable/lightable.css" rel="stylesheet" />


<div id="hiv-rate-and-life-expectancy" class="section level2">
<h2>HIV Rate and Life Expectancy</h2>
<p>The purpose of this project is to analyze the relationship between HIV rate and life expectancy by regions.</p>
<div id="loading-inspecting-and-joining-datasets" class="section level3">
<h3>Loading, inspecting and joining datasets</h3>
<p><strong>Loading data</strong></p>
<p>The first step, is to load the data: I load the gapminder HIV data and life expectancy data using read_csv to convert the csv files. The worldbank data instead is loaded from a package wbstats. Because I don’t need all the data I select the indicators I am interested in and filter by indicator, start- and end-date. Last but not least, I create the dataset countries from the wbstats package.</p>
<pre class="r"><code># load gapminder HIV data
hiv &lt;- read_csv(here::here(&quot;static&quot;, &quot;data&quot;,&quot;adults_with_hiv_percent_age_15_49.csv&quot;))

#load life expectancy data
life_expectancy &lt;- read_csv(here::here(&quot;static&quot;,&quot;data&quot;,&quot;life_expectancy_years.csv&quot;))

# get World bank data using wbstats
indicators &lt;- c(&quot;SP.DYN.TFRT.IN&quot;,&quot;SE.PRM.NENR&quot;, &quot;SH.DYN.MORT&quot;, &quot;NY.GDP.PCAP.KD&quot;)

library(wbstats)

worldbank_data &lt;- wb_data(country=&quot;countries_only&quot;, #countries only- no aggregates like Latin America, Europe, etc.
                          indicator = indicators, 
                          start_date = 1960, 
                          end_date = 2016)

# get a dataframe of information regarding countries, indicators, sources, regions, indicator topics, lending types, income levels,  from the World Bank API 
countries &lt;-  wbstats::wb_cachelist$countries</code></pre>
<p><strong>Inspecting the dataframes (life_expectancy, worldbank_data, and HIV)</strong></p>
<p>Before joining the datasets I need to tidy the data first.
I skim the datasets to get a basic understanding of the structure, the missingness and the variable types.</p>
<p>The dataset HIV rate has extensive missingness. Notably, in the World Bank data, Primary School enrollment has just a 33.4% complete rate. In the HIV data, there is a high rate of completeness across years, but only after 1987. In the Life Expectancy dataset, there is very low levels of missingness relative to the data size, with approximately 98% completeness across variables (whether retrospective or forecast).</p>
<p><strong>Tidying datasets</strong></p>
<p>Then I use the function pivot_longer() to tidy the datasets where needed creating life_expectancy_clean and hiv_clean. In this case, I did it for life expectancy and for hiv data. Because I will not need a different structure for the worldbank data I don’t tidy this dataset. Furthermore, I change the data type of the variable “year” in life_expectancy_clean and hiv_clean to numerical ones to be able to join them with the worlbank data. I change also the name of the variables of the worldbank data to more meaningful names.
To control the changes made, I skim the cleaned datasets.</p>
<pre class="r"><code>#I clean the data by tidying it up (tidyr)
life_expectancy_clean &lt;- life_expectancy %&gt;% 
  pivot_longer(names_to=&quot;year&quot;, values_to=&quot;life_expect&quot;, cols= -country) %&gt;% 
  transform(year = as.numeric(year)) #in order to be able to join the three datasets I need the same data types

hiv_clean &lt;- hiv %&gt;% 
  pivot_longer(names_to=&quot;year&quot;, values_to =&quot;hiv_rate&quot;, cols= - country) %&gt;% 
  transform(year = as.numeric(year)) #in order to be able to join the three datasets I need the same data types

worldbank_data_clean &lt;- worldbank_data %&gt;% 
  #I change the names to have more meaningful names, but I don&#39;t use pivot_longer as this is not needed to resolve the questions
  rename(&quot;GDP_per_capita&quot;=NY.GDP.PCAP.KD, 
         &quot;School_enrollment_primary&quot;= SE.PRM.NENR, 
         &quot;Mortality_rate_under5&quot;=SH.DYN.MORT,
         &quot;Fertility_rate&quot; =SP.DYN.TFRT.IN, 
         &quot;year&quot;=date)

#I check if the data types have been changed
skim(hiv_clean)
skim(life_expectancy_clean)
skim(worldbank_data_clean)</code></pre>
<p><strong>Adding key for countries</strong></p>
<p>In the various datasets the countries are named slightly different. Therefore, I am adding the countrycode “iso3c” to all datasets. After checking the result, I add the missing countries (“Kosovo” and “Channel Islands”) manually.</p>
<pre class="r"><code>#creating iso3c code to join datasets and joining datasets
library(countrycode)
hiv_clean &lt;- hiv_clean %&gt;% 
  mutate(&quot;iso3c&quot; = countrycode(hiv_clean$country, origin = &#39;country.name&#39;, destination = &#39;iso3c&#39;, #creating the iso3c column to join
                               custom_match = c(&quot;Kosovo&quot;=&quot;XKX&quot;, &quot;Channel Islands&quot; =&quot;CHI&quot;)))  #joining the missing 2 countries manually
life_expectancy_clean &lt;-life_expectancy_clean %&gt;% 
  mutate(&quot;iso3c&quot; = countrycode(life_expectancy_clean$country, origin = &#39;country.name&#39;, destination = &#39;iso3c&#39;, #creating the iso3c column to join
                               custom_match = c(&quot;Kosovo&quot;=&quot;XKX&quot;, &quot;Channel Islands&quot; =&quot;CHI&quot;)))  #joining the missing 2 countries manually</code></pre>
<p>As I found 46,483 missing observations by only merging by “country”, I created the iso3c code for the dataset hiv_clean and life_expectancy. Two countries, “Channel Islands” and “Kosovo” have to be matched with the country dataset manually.</p>
<p>Let’s check if all countries are assigned:</p>
<pre class="r"><code>#I check if I can match correctly by: 
region_missing &lt;- hiv_clean %&gt;% 
  full_join(worldbank_data_clean, by=c(&quot;iso3c&quot;, &quot;year&quot;)) %&gt;% #I don&#39;t want to lose data
  full_join(life_expectancy_clean, by=c(&quot;iso3c&quot;, &quot;year&quot;)) %&gt;% #I don&#39;t want to lose data  
  left_join(select(countries, c(&quot;iso3c&quot;, &quot;region&quot;)), by= c(&quot;iso3c&quot;)) #I don&#39;t want to lose values
unique(region_missing[is.na(region_missing$region),]$country)</code></pre>
<pre><code>## character(0)</code></pre>
<p><strong>Joining datasets</strong></p>
<p>Finally, I perform the relevant join function. In order to select the correct join function I look at the different <a href="http://r4ds.had.co.nz/relational-data.html">join operations</a>.</p>
<pre class="r"><code>worldbank_hiv_life_expectancy &lt;- worldbank_data_clean %&gt;% 
  full_join(hiv_clean,by=c(&quot;iso3c&quot;, &quot;year&quot;)) %&gt;% #I don&#39;t want to lose data
  full_join(life_expectancy_clean,by=c(&quot;iso3c&quot;, &quot;year&quot;)) %&gt;%  #I don&#39;t want to lose data
  select(!c(&quot;country&quot;, &quot;country.x&quot;, &quot;country.y&quot;)) # I don&#39;t want to have plenty different values for country

# adding regions and countryname from the datset countries
worldbank_hiv_life_expectancy_region &lt;- worldbank_hiv_life_expectancy %&gt;% 
  left_join(select(countries, c(&quot;iso3c&quot;, &quot;region&quot;,&quot;country&quot;)), by= c(&quot;iso3c&quot;))


unique(worldbank_hiv_life_expectancy_region[is.na(worldbank_hiv_life_expectancy_region$region),]$country) #identify missing values by region
skim(worldbank_hiv_life_expectancy_region) #check the new dataset for missingness</code></pre>
<p>I decide to use the full_join() function to join the three datasets in order to not lose any of the values, especially because I are later asked which region has the most observations with missing HIV data. Otherwise, I would have selected only the years in which I have relevant hiv data (1990 - 2011). To add the regions, I used the left join as I only want to add the region to the existing observations.</p>
</div>
<div id="what-is-the-relationship-between-hiv-prevalence-and-life-expectancy" class="section level3">
<h3>What is the relationship between HIV prevalence and life expectancy?</h3>
<p>In order to analyse the relationship between HIV prevalence and life expectancy I create a scatterplot using ggplot.</p>
<pre class="r"><code>#I create a scatterplot with a smoothing line, and remove 2 outliers with life expectancy below 40 years in order to increase the interpretability of the output

ggplot(worldbank_hiv_life_expectancy_region, aes(y=life_expect, x=hiv_rate))+ #I want to inspect how HIV rate changes the life expectancy
  geom_point(alpha=0.1, na.rm=TRUE)+ #scatterplot
  geom_smooth(na.rm=TRUE)+ #ading a line
  theme_fivethirtyeight()+ #sleceted theme
  theme(axis.title = element_text())+ #adding title (has been removed by theme)
  labs(y=&quot;Life Expectancy (Years)&quot;, x= &quot;HIV Rate (%)&quot;, title=&quot;On Average, People in Countries with Less than 5% HIV Rates Live Longer&quot;, subtitle = &quot;Relationship between HIV rate and life expectancy&quot;)+ scale_x_continuous(breaks=seq(0,25,5), limits=c(0,25)) + scale_y_continuous(breaks=seq(40,85,10), limits=c(40,85))+ #adding labels
  NULL</code></pre>
<p><img src="/blogs/blog7_files/figure-html/relationship_HIV_life_expectancy-1.png" width="1152" style="display: block; margin: auto;" />
This scatterplot depicts the average relationship between HIV rate and the life expectancy across all sampled countries. It appears that, on average, life expectancy decreases with an increasing HIV rate. There seems to be a strong negative relationship in countries with life expectancy between 0 and 5%, where each percentage increase in HIV rate is correlated with a steep decrease in average life expectancy. Above 5% the life expectancy remains almost stable.</p>
<p>Now, let’s facet by region. I am using scales = “free” to make every facet of the plot readable.</p>
<pre class="r"><code>ggplot(worldbank_hiv_life_expectancy_region, aes(y=life_expect, x=hiv_rate, na.rm=TRUE))+ #I want to inspect how hiv rate changes the life expectancy
  geom_point(alpha=0.1, na.rm=TRUE)+
  geom_smooth(na.rm=TRUE, size=0.5)+
  facet_wrap(~region,scales=&quot;free&quot;)+ #facet by region with free scale- otherwise data of some regions not readable
  theme_fivethirtyeight()+
  theme(axis.title = element_text())+
  labs(y=&quot;Life Expectancy (Years)&quot;, x= &quot;HIV Rate (%)&quot;, title=&quot;The Relationship between HIV Rate and Life Expectancy is Region-Specific&quot;, subtitle = &quot;Relationship between HIV rate and life expectancy across world regions&quot;)</code></pre>
<p><img src="/blogs/blog7_files/figure-html/HIV_presence_life_expectancy_facet-1.png" width="960" style="display: block; margin: auto;" />
The plot above depicts the relationship between HIV rate and life expectancy faceted by region and demonstrates that there is no clear relationship between the two variables. For the South Asian and the Sub-Saharan African region, for exampl, life expectancy doesn’t seem to change depending on the HIV rate at all. Also in North America, Europe &amp; Central Asia and East Asia &amp; Pacific no compelling relationship can be seen. Only in Latin America &amp; Caribbean and the Middle East &amp; North Africa does the life expectancy decrease notably with an increasing HIV rate. Overall, no compelling relationship between HIV prevalence and life expectancy can be established.</p>
</div>
<div id="which-regions-have-the-most-observations-with-missing-hiv-data" class="section level3">
<h3>Which regions have the most observations with missing HIV data?</h3>
<p>To detect which region has the most observations with missing values I create a table in descending order:</p>
<pre class="r"><code>missing_hiv &lt;- worldbank_hiv_life_expectancy_region %&gt;% 
  select(&quot;hiv_rate&quot;,&quot;region&quot;) %&gt;% 
  filter(is.na(hiv_rate)) %&gt;% #filtered only values with regions and NA&#39;s for HIV rate
  group_by(region) %&gt;% 
  summarise(count =n()) %&gt;% 
  arrange(desc(count))

kbl(missing_hiv,col.names=c(&quot;Region&quot;,&quot;Number of NA Values in HIV Rate Data&quot;)) %&gt;%
  kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Region
</th>
<th style="text-align:right;">
Number of NA Values in HIV Rate Data
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Europe &amp; Central Asia
</td>
<td style="text-align:right;">
14325
</td>
</tr>
<tr>
<td style="text-align:left;">
Sub-Saharan Africa
</td>
<td style="text-align:right;">
13478
</td>
</tr>
<tr>
<td style="text-align:left;">
Latin America &amp; Caribbean
</td>
<td style="text-align:right;">
9609
</td>
</tr>
<tr>
<td style="text-align:left;">
East Asia &amp; Pacific
</td>
<td style="text-align:right;">
8337
</td>
</tr>
<tr>
<td style="text-align:left;">
Middle East &amp; North Africa
</td>
<td style="text-align:right;">
6082
</td>
</tr>
<tr>
<td style="text-align:left;">
South Asia
</td>
<td style="text-align:right;">
2252
</td>
</tr>
<tr>
<td style="text-align:left;">
North America
</td>
<td style="text-align:right;">
613
</td>
</tr>
</tbody>
</table>
<p>Now, I visualize the table with a bar chart (<code>geom_col()</code>), in descending order.</p>
<pre class="r"><code>ggplot(missing_hiv, aes(x= count, y=reorder(region, count)))+
  geom_col()+
  labs(x=&quot;Number of N/A&quot;, y=&quot;Region&quot;, title=&quot;Europe &amp; Central Asia Has the Greatest Number of Missing Values in HIV Rate Data&quot;, subtitle=&quot;Number of missing values for HIV rate by region&quot;)+
  theme_fivethirtyeight()+
  theme(axis.title=element_text())</code></pre>
<p><img src="/blogs/blog7_files/figure-html/HIV_missingness_plot-1.png" width="1440" style="display: block; margin: auto;" />
I find that the Europe &amp; Central Asia region has the most observations with missing HIV data, in raw terms, followed by Sub Sahran Africa.</p>
</div>
</div>
