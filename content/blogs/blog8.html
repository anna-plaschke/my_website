---
categories:
- ""
- ""
date: "2020-09-14T22:42:51-05:00"
description: Covid 19 analyses
draft: false
image: pic11.jpg
keywords: ""
slug: blog8
title: CDC COVID-19 Public Use Data
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="cdc-covid-19-public-use-data" class="section level1">
<h1>CDC COVID-19 Public Use Data</h1>
<pre class="r"><code>#I am unsing the [CDC Covid-19 Case Surveillance Data](https://data.cdc.gov/Case-Surveillance/COVID-19-Case-Surveillance-Public-Use-Data/vbim-akqf). There are well over 3 million entries of individual, de-identified patient data. Since this is a large file, I use `vroom` to load it and you keep `cache=TRUE` in the chunk options.


# URL link to CDC to download data
url &lt;- &quot;https://data.cdc.gov/api/views/vbim-akqf/rows.csv?accessType=DOWNLOAD&quot;

covid_data &lt;- vroom(url)%&gt;%
  clean_names()</code></pre>
<p><strong>(1) - Given the data I have, I would like to produce a graph that shows death % rate: by age group, sex, and whether the patient had co-morbidities or not</strong></p>
<pre class="r"><code>plot1_data &lt;- covid_data %&gt;% 
  
  # remove implicit NAs, &quot;Missing&quot;, &quot;Unknown&quot; in columns
  filter(death_yn %in% c(&#39;Yes&#39;,&#39;No&#39;), # contains &quot;Missing&quot;,&quot;Unknown&quot; 
         
         sex %in% c(&#39;Female&#39;,&#39;Male&#39;), # contains &quot;Other&quot;, not needed for the plot
         
         medcond_yn %in% c(&#39;Yes&#39;,&#39;No&#39;), # contains &quot;Missing&quot;,&quot;Unknown&quot; 
         
         age_group != &#39;Unknown&#39;) %&gt;% # contains &quot;Unknown&quot;
  
  # keep columns I want only for higher efficiency
  select(sex,age_group,death_yn,medcond_yn) %&gt;% 
  
  # group_by age, sex, and co-morbidities status
  group_by(age_group,sex,medcond_yn) %&gt;% 
  
  # count death and total cases within group
  summarise(death = sum(death_yn == &#39;Yes&#39;), total = n()) %&gt;% 
  
  # calculate death_rate = death/total
  mutate(death_rate = death/total)

#we review the dataset that I have specified
skim(plot1_data)</code></pre>
<pre class="r"><code>plot1_data %&gt;% 
  
  # create a new ggplot
  ggplot(aes(y = death_rate, 
             x = age_group)) + 
  
  # create a geom layer for the bars
  geom_col(fill = &#39;#6b7da2&#39;) +
  
  # add data label for bars
  geom_text(size=2.5, aes(label = round(100*death_rate,digits = 1), # round number
                y = death_rate + 0.05)) + # adjust position for label
  
  # facet by sex &amp; co-morbidities status
  facet_grid(cols = vars(sex),
             rows = vars(factor(medcond_yn, ordered = TRUE, # rename and order factor levels 
                                 levels = c(&#39;Yes&#39;,&#39;No&#39;),
                                 labels = c(&#39;With comorbities&#39;,
                                            &#39;Without comorbidities&#39;)))) + 
  # add labs
  labs(title = &#39;&#39;,
       subtitle = &#39;Covid death % by age group, sex and presence of co-morbidities&#39;,
       x = &#39;&#39;,
       y = &#39;&#39;,
       caption = &#39;Source: CDC&#39;) +
  
  # death rate axis shown in percentage
  scale_y_continuous(labels = label_percent()) +
  
  # flip x and y axis
  coord_flip() +
  
  theme_bw()</code></pre>
<p><img src="/blogs/blog8_files/figure-html/plot_1_plotting-1.png" width="768" style="display: block; margin: auto;" /></p>
<p><strong>(2) - Given the data, I would like to produce a graph that shows death % rate: by age group, sex, and whether the patient was admitted to Intensive Care Unit (ICU) or not.</strong></p>
<pre class="r"><code>plot2_data &lt;- covid_data %&gt;% 
  
  # remove implicit NAs, &quot;Missing&quot;, &quot;Unknown&quot; in columns
  filter(death_yn %in% c(&#39;Yes&#39;,&#39;No&#39;), # contains &quot;Missing&quot;,&quot;Unknown&quot; 
         
         sex %in% c(&#39;Female&#39;,&#39;Male&#39;), # contains &quot;Other&quot;, not needed for the plot
         
         icu_yn %in% c(&#39;Yes&#39;,&#39;No&#39;), # contains &quot;Missing&quot;,&quot;Unknown&quot; 
         
         age_group != &#39;Unknown&#39;) %&gt;% # contains &quot;Unknown&quot;
  
  
  # keep columns I want only for higher efficiency
  select(sex,age_group,death_yn,icu_yn) %&gt;% 
  
  # group_by age, sex, and icu status 
  group_by(age_group,sex,icu_yn) %&gt;% 
  
  # count death and total cases within group
  summarise(death = sum(death_yn == &#39;Yes&#39;), total = n()) %&gt;% 
  
  # calculate death_rate = death/total
  mutate(death_rate = death/total)

#I review the dataset that we have specified
skim(plot2_data)</code></pre>
<pre class="r"><code>plot2_data %&gt;% 
  
  # create a new ggplot
  ggplot(aes(y = death_rate, 
             x = age_group)) + 
  
  # create a geom layer for the bars
  geom_col(fill = &#39;#fb9584&#39;) +
  
  # add data label for bars
  geom_text(size=2.5, aes(label = round(100*death_rate,digits = 1), # round number
                y = death_rate + 0.05)) + # adjust position for label
  
  # facet by sex &amp; icu status
  facet_grid(cols = vars(sex),
             rows = vars(factor(icu_yn, ordered = TRUE, # rename and order factor levels 
                                 levels = c(&#39;Yes&#39;,&#39;No&#39;),
                                 labels = c(&#39;Admitted to ICU&#39;,&#39;Not admitted to ICU&#39;)))) + 

  # add labs
  labs(title = &#39;&#39;,
       subtitle = &#39;Covid death % by age group, sex and whether patient was admitted to ICU&#39;,
       x = &#39;&#39;,
       y = &#39;&#39;,
       caption = &#39;Source: CDC&#39;) +
  
  # death rate axis shown in percentage
  scale_y_continuous(labels = label_percent()) +
  
  # flip x and y axis
  coord_flip() +
  
  theme_bw()</code></pre>
<p><img src="/blogs/blog8_files/figure-html/plot_2_plotting-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
